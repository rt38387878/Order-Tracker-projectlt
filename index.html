
<!DOCTYPE html>
<html lang="fa" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <title>Whale Order Tracker</title>
  <style>
    body { background: #121212; color: #e0e0e0; font-family: sans-serif; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px; text-align: center; }
    .buy { color: #00e676; }
    .sell { color: #ff3d00; }
  </style>

let recentOrders = [];

function updateAIAnalysis(dir, volume) {
  if (recentOrders.length > 50) recentOrders.shift();
  recentOrders.push({ dir, volume });

  let buyVol = 0, sellVol = 0;
  for (const ord of recentOrders) {
    if (ord.dir === 'buy') buyVol += ord.volume;
    else sellVol += ord.volume;
  }

  const total = buyVol + sellVol;
  if (total === 0) return;

  const buyPercent = (buyVol / total) * 100;
  const resultText = `Ø¯Ø± ÛµÛ° Ø³ÙØ§Ø±Ø´ Ø§Ø®ÛŒØ±ØŒ ${buyPercent.toFixed(1)}Ùª Ø­Ø¬Ù… Ø¯Ø± Ø³Ù…Øª Ø®Ø±ÛŒØ¯ Ø¨ÙˆØ¯Ù‡. ` +
    (buyPercent > 60 ? "ğŸ”¼ Ø±ÙˆÙ†Ø¯: Ù‚Ø¯Ø±Øª Ø¯Ø± Ø³Ù…Øª Ø®Ø±ÛŒØ¯" :
     buyPercent < 40 ? "ğŸ”½ Ø±ÙˆÙ†Ø¯: Ù‚Ø¯Ø±Øª Ø¯Ø± Ø³Ù…Øª ÙØ±ÙˆØ´" :
     "â– Ø±ÙˆÙ†Ø¯: Ù…ØªØ¹Ø§Ø¯Ù„");

  document.getElementById("analysis").textContent = resultText;
}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Whale Order Tracker</h1>
  <label>Ø¬ÙØªâ€ŒØ§Ø±Ø²:
    <select id="pair">
      <option>BTCUSDT</option><option>ETHUSDT</option><option>BNBUSDT</option>
    </select>
  </label>
  <label>Ø­Ø¯Ø§Ù‚Ù„ Ø³ÙØ§Ø±Ø´ (USDT): <input type="number" id="minSize" value="50000"></label>
  <p id="status">Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...</p>
  <p id="analysis">Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§...</p>
  <canvas id="chart" height="200"></canvas>
  <table><thead><tr><th>Ø¬Ù‡Øª</th><th>Ù‚ÛŒÙ…Øª</th><th>Ø­Ø¬Ù…</th><th>Ø²Ù…Ø§Ù†</th></tr></thead>
    <tbody id="orders"></tbody>
  </table>

  <script>
    const ctx = document.getElementById('chart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'bar',
      data: { labels: [], datasets: [{ label: 'Ø­Ø¬Ù… Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§', data: [], backgroundColor: [] }] },
      options: { scales: { x: { display: false }, y: { beginAtZero: true } } }
    });

    let ws;
    function connect() {
      const pair = document.getElementById('pair').value.toLowerCase();
      ws && ws.close();
      ws = new WebSocket(`wss://stream.binance.com:9443/ws/${pair}@aggTrade`);
      ws.onopen = () => document.getElementById('status').textContent = 'Ù…ØªØµÙ„ Ø¨Ù‡ ' + pair;
      ws.onmessage = msg => {
        const data = JSON.parse(msg.data);
        const price = parseFloat(data.p), qty = parseFloat(data.q);
        const usdVol = price * qty;
        const min = parseFloat(document.getElementById('minSize').value);
        if (usdVol >= min) {
          const dir = data.m ? 'sell' : 'buy';
          const row = document.getElementById('orders').insertRow(0);
          row.innerHTML = `<td class="${dir}">${dir.toUpperCase()}</td><td>${price}</td><td>${qty}</td><td>${new Date().toLocaleTimeString()}</td>`;
          chart.data.labels.push(new Date().toLocaleTimeString());
          chart.data.datasets[0].data.push(usdVol);
          chart.data.datasets[0].backgroundColor.push(dir === 'buy' ? '#00e676' : '#ff3d00');
          chart.update();
          if (chart.data.labels.length > 20) {
            chart.data.labels.shift();
            chart.data.datasets[0].data.shift();
            chart.data.datasets[0].backgroundColor.shift();
          }
        }
      };
    }

    document.getElementById('pair').addEventListener('change', connect);
    document.getElementById('minSize').addEventListener('change', () => {
      document.getElementById('orders').innerHTML = '';
      chart.data.labels = []; chart.data.datasets[0].data = []; chart.data.datasets[0].backgroundColor = [];
    });

    connect();
  </script>
</body>
</html>
